{% extends "core/base.html" %}
{% load i18n %}
{% load humanize %}

{% block title %}<h1>{% trans "Domestic tournaments" %}</h1>{% endblock %}

{% block content %}
    <!-- Filters -->
    {% include "core/partials/competition_filters.html" %}

    {% if tournaments %}
        <div class="d-none d-md-block">
            <table class="table align-middle">
                <thead>
                    <tr class="align-middle">
                        <th scope="col"></th>
                        <th scope="col">{% trans "Rosters" %}<br /><small class="text-muted">{% trans "Deadline" %}</small></th>
                        <th scope="col">{% trans "Season" %}</th>
                        <th scope="col">{% trans "Tournament" %}<br /><small class="text-muted">{% trans "Competition" %}</small></th>
                        <th scope="col">{% trans "Location" %}<br /><small class="text-muted">{% trans "Date" %}</small></th>
                        <th scope="col" class="fit pe-5 text-center">
                            <div data-bs-toggle="tooltip" data-bs-title="{% trans "Total teams / members" %}">{% trans "Total" %}<br />T / M</div>
                        </th>
                        <th scope="col">{% trans "Winner" %}<br /><small class="text-muted">{% trans "SOTG" %}</small></th>
                    </tr>
                </thead>
                <tbody>
                    {% for tournament in tournaments %}
                        <tr>
                            <td>
                                {% if tournament.includes_my_club_team %}
                                    <i
                                        class="bi bi-check"
                                        style="color: green;"
                                        data-bs-toggle="tooltip"
                                        data-bs-title="{% trans "Your club has a team in this tournament" %}"
                                    ></i>
                                {% endif %}
                            </td>
                            <td>
                                {% if tournament.has_open_rosters %}
                                    <span class="badge text-bg-success">{% trans "OPEN" %}</span>
                                {% else %}
                                    <span class="badge text-bg-dark">{% trans "CLOSED" %}</span>
                                {% endif %}
                                <br />
                                <small class="text-muted">{{ tournament.rosters_deadline | date:'d/m/Y H:i' }}</small>
                            </td>
                            <td>
                                {{ tournament.competition.season }}<br />
                                <small class="text-muted">
                                    {{ tournament.competition.get_environment_display | upper }}
                                </small>
                            </td>
                            <td>
                                <a href="{% url 'tournaments:detail' tournament.id %}" class="text-primary">
                                    {{ tournament.name }}
                                </a>
                                <br />
                                <small class="text-muted">
                                    {{ tournament.competition.name }}
                                    <span style="position: relative; top: -2px;">
                                        <span
                                            class="badge text-bg-primary text-bg-{{ tournament.competition.division | lower }}"
                                            >{{ tournament.competition.division | upper }}</span
                                        >
                                        {% if tournament.competition.age_limit %}
                                            <span class="badge text-bg-primary"
                                                >{{ tournament.competition.age_limit | upper }}</span
                                            >
                                        {% endif %}
                                    </span>
                                </small>
                            </td>
                            <td>
                                {{ tournament.location }}<br />
                                <small class="text-muted"
                                    >{{ tournament.start_date | date:'d.m' }}.–{{ tournament.end_date | date:'d.m.Y' }}</small
                                >
                            </td>
                            <td>
                                {% if tournament.team_count %}
                                    {{ tournament.team_count }}
                                    / {{ tournament.member_count }}
                                {% endif %}
                            </td>
                            <td>
                                {% if tournament.winner_team %}
                                    {{ tournament.winner_team.application.team_name }}<br />
                                    {% if tournament.sotg_winner_team %}
                                        <small class="text-muted"
                                            >{{ tournament.sotg_winner_team.application.team_name }}</small
                                        >
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="d-block d-md-none">
            <div class="list-group">
                {% for tournament in tournaments %}
                    <div
                        class="list-group-item {% if tournament.includes_my_club_team %}list-group-item-success{% endif %} text-black"
                    >
                        <div class="d-flex w-100 justify-content-between">
                            <div>
                                <small class="text-muted">
                                    {{ tournament.competition.season }} •
                                    {{ tournament.competition.get_environment_display | upper }}
                                </small>

                                <div>
                                    <b>{{ tournament.competition.name }}</b>
                                    <span style="position: relative; top: -2px;">
                                        <span
                                            class="badge text-bg-primary text-bg-{{ tournament.competition.division | lower }}"
                                        >
                                            {{ tournament.competition.division | upper }}
                                        </span>
                                        {% if tournament.competition.age_limit %}
                                            <span class="badge text-bg-primary">
                                                {{ tournament.competition.age_limit | upper }}
                                            </span>
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                            <div>
                                {% if tournament.has_open_rosters %}
                                    <span class="badge text-bg-success">{% trans "OPEN" %}</span>
                                {% else %}
                                    <span class="badge text-bg-dark">{% trans "CLOSED" %}</span>
                                {% endif %}
                            </div>
                        </div>
                        <a href="{% url 'tournaments:detail' tournament.id %}" class="text-primary h5">
                            {{ tournament.name }}
                        </a>
                        <div>
                            {{ tournament.location }} • {{ tournament.start_date | date:'d.m.Y' }} -
                            {{ tournament.end_date | date:'d.m.Y' }}
                        </div>
                        <div>{% blocktrans with deadline=tournament.rosters_deadline|date:'d/m/Y H:i' %}Rosters deadline: {{ deadline }}{% endblocktrans %}</div>
                        <div>{% blocktrans with teams=tournament.team_count members=tournament.member_count %}Total teams/members: {{ teams }}/{{ members }}{% endblocktrans %}</div>
                        {% if tournament.winner_team %}
                            <div>{% blocktrans with winner=tournament.winner_team.application.team_name %}Winner: {{ winner }}{% endblocktrans %}</div>
                        {% endif %}
                        {% if tournament.sotg_winner_team %}
                            <div>{% blocktrans with spirit=tournament.sotg_winner_team.application.team_name %}Spirit: {{ spirit }}{% endblocktrans %}</div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <div class="alert alert-primary" role="alert">
            <i class="bi bi-info-circle-fill me-1"></i> {% trans "No tournaments found." %}
        </div>
    {% endif %}
{% endblock %}
